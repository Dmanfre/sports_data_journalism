---
title: "background.qmd"
format: html
editor: visual
name: Dylan Manfre
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.



Story idea: I will be doing story idea No. 1 about whether having a good assist-to-turnover ratio actually leads to more wins and analyzing if it is a good measure of team success.

Questions in Canvas assignment

1) Does that data already exist? Can you get it?
2) Do you need assistance in getting it?
3) What time frame do you want/need data from?
4) Will you have to improve or augment the data in order to answer your question? If so, how?
5) Are there other examples of this kind of work (specific or general)? If so, provide them.

Response
1) The data does exist. I can use box score data and game logs from women's college basketball games. I believe I can get this through the sportsdataverse or a wehoops R package which already has the data inside of it.
2) I may need a little assistace getting the data because there will likely be multiple files that are similar but finding the right one for this analysis is essential to the project.
3) I would like to use data from last season 2022-23. I think this would be a good time frame to use because Brenda Frese talked about how having an assist-to-turnover ratio was essential to the team's success. I'm wondering if a text analysis could be a good part of this project to see exactly how many times she said the phrase "assist-to-turnover" ratio last season.
4) I don't believe there will be too much to agument. Unless the dataset does not already have an assist-to-turnover ratio column. If that is not there, I would need to create it by doing a mutate(ATo_ratio = sum(assits) / sum(Turnovers) * 100). Then I would need to calculate a linear model and 
5) Haven't found many articles outlining an analysis in the form of a narrative story but there have been smaller articles. 
https://statathlon.com/team_stats_analysing_impact/#:~:text=That%20the%20assist%20to%20turnover,is%20not%20always%20the%20rule.

```{r}
#libraries
library(tidyverse)
#install.packages("wehoop")
library(wehoop)
library(tictoc)
library(ggplot2)
install.packages("ggrepel")
library(ggrepel)


```


```{r}
# loading data from wehoops library

game_boxes_with_teams <- read_csv("game_boxes_with_teams.csv")
View(game_boxes_with_teams)

```

cleaning
```{r}
#column rename

game_boxes_with_teams <- game_boxes_with_teams %>% 
  rename( Team_AToR = ast_tov_ratio,
          Opp_AToR = opp_ast_tov_ratio,
          win_loss = win)

#fiter out NAs
game_boxes_with_teams <- game_boxes_with_teams %>%
  filter(!is.na(Team_AToR))

AToR_only <- game_boxes_with_teams %>% 
  select(ncaa_game_id, gamedate_east, home_team_name, away_team_name, win_loss, Team_AToR, Opp_AToR)

```

Lists
```{r}

big_ten <- c("Indiana", "Maryland", "Michigan", "Michigan State", "Minnesota", "Nebraska", "Northwestern", "Ohio State", "Penn State", "Purdue", "Rutgers", "Illinois", "Iowa", "Wisconsin")

power_5 <- c("ACC", "Big 12", "Big Ten", "Pac-12", "SEC")


```

Create an if_else statement to popualte a columns called "winner" showing the winning team name and do it on the first dataframe. 

If away team points were greater than home team, put away team name
if home team points were greater than away team points, put home team name. 
```{r}
#columns
#pts = home team points
#opp_pts = away team points 
#home_team_name
#away_team_name

game_boxes_with_teams <- game_boxes_with_teams %>% 
  mutate(winner = ifelse(opp_pts > pts, away_team_name, home_team_name))

#make sure it worked
game_boxes_with_teams %>% 
  select(home_team_name, pts, away_team_name, opp_pts, winner)
#Confirmed that it does
```

Then do group by and counts with that new column. 



Hypothesis: Having an assist-to-turnover ratio over 2 leads to moe wins. 

What I want to do is see the percentage of games that had an assist to turnover ratio of a certain number and then generate a percentage of those games that resulted in wins and those that resulted in loses. 

# The average team astor is 0.9717791 I will use this number to base my filter
# The average opp astor is 0.7773279 I will use this number to base my filter of the opponents.
```{r}
game_boxes_with_teams %>%
  summarize(Average_AToR = mean(Team_AToR),
    Average_oppAToR = mean(Opp_AToR)
  )

game_boxes_with_teams %>% 
filter(Team_AToR >= 0.97)

```
6,243 games resulted in wins with teams that had an astor over 0.97.

Number of games when a team's ATOR was > than Opponents 
```{r}

game_boxes_with_teams %>% 
filter(Team_AToR > Opp_AToR) %>% 
count()
#9515

game_boxes_with_teams %>% 
filter( Opp_AToR > Team_AToR) %>% 
count()
#6052

```

I want to see how many wins each team has.

```{r}

total_home_wins <- game_boxes_with_teams %>% 
  filter(win_loss == 1) %>% 
  group_by(home_team_name, home_team_conference) %>% 
  summarize(total_wins = sum(win_loss)) %>%
  arrange(desc(total_wins))

view(total_home_wins)

#This is wrong and needs to be updated
# I did it this way because I figured since I was doing the same thing, I copied and pasted and changed the dataframes. 
total_away_wins <- game_boxes_with_teams %>% 
  filter(win_loss == 1) %>% 
  group_by(away_team_name, away_team_conference) %>% 
  summarize(total_wins = sum(win_loss)) %>%
  arrange(desc(total_wins))

```


Season ATOR
```{r}
#home team
avg_ator_season <-  game_boxes_with_teams %>% 
  group_by(home_team_name, home_team_conference) %>% 
  summarise(avg_team_ator = mean(Team_AToR),
            avg_opp_ator = mean(Opp_AToR))

joined_home_team_ator <- inner_join(avg_ator_season, total_home_wins, by ="home_team_name")

joined_home_team_ator <- joined_home_team_ator %>% 
select(-home_team_conference.y)

#opp 

avg_ator_season_away <-  game_boxes_with_teams %>% 
  group_by(away_team_name, away_team_conference) %>% 
  summarise(avg_team_ator = mean(Team_AToR),
            avg_opp_ator = mean(Opp_AToR))

joined_away_team_ator <- inner_join(avg_ator_season_away, total_away_wins, by ="away_team_name")

joined_away_team_ator <- joined_away_team_ator %>% 
  select(-away_team_conference.y) %>% 
  rename(away_team_confernece = away_team_conference.x)

```


I want to to identify the average astor's in wins and loses.

Analysis: Teams have a larger Assist to turn over ratio in wins than losses which makes sense because it shows a team is sharing the ball well and also maintaining ball good ball control. It's a staggering difference 
```{r}
avg_ator_w_and_l <- game_boxes_with_teams %>% 
filter(win_loss == "1") %>% 
  summarize(Average_AToR = mean(Team_AToR),
    Average_oppAToR = mean(Opp_AToR)
  )
```


Also curious to see what team had the most games with an above average AToR... this could be a graph I think... use a scatter plot the code is in the textbook. 

Then look at any outliers. 

joined_home_team_ator is a dataframe showing the number of wins and the home team's avg ator for the season. I want to filter this so that teams in the Big Ten are highlighted. 
```{r}
b10 <- joined_home_team_ator %>% 
filter(home_team_conference == "Big Ten")

p5 <- joined_home_team_ator %>% 
filter(home_team_conference %in% power_5)
```

Just the big ten
```{r}
ggplot(data=joined_home_team_ator, aes(x = total_wins, y = avg_team_ator)) +
  geom_point(data = b10, aes(x = total_wins, y = avg_team_ator)) +
  labs(title = "Team Wins vs. Average Assist to Turnover Ratio",
       x = "Total Wins",
       y = "Team Assist to Turnover Ratio") +
  geom_text_repel(data = b10, aes(x = total_wins, y = avg_team_ator, label = home_team_name))
```

Showing the big ten among everyone else. 
the lowering of the opasity was done via chat gpt
```{r}
ggplot() +
  geom_point(data = joined_home_team_ator, aes(x = total_wins, y = avg_team_ator), alpha = 0.2) +
  geom_point(data = b10, aes(x = total_wins, y = avg_team_ator), color = "red") +
  geom_smooth(data=joined_home_team_ator, aes(x=total_wins, y=avg_team_ator), method="lm") +
  labs(title = "Big Ten Wins vs. Average Assist to Turnover Ratio",
       x = "Total Wins",
       y = "Team Assist to Turnover Ratio") +
  geom_text_repel(data = b10, aes(x = total_wins, y = avg_team_ator, label = home_team_name))

```

We see a left to right line here climbing up suggesting that there is a relationship. 

only showing pwoer 5 conferences 
```{r}

ggplot(data=joined_home_team_ator, aes(x = total_wins, y = avg_team_ator)) +
  geom_point(data = p5, aes(x = total_wins, y = avg_team_ator)) +
  labs(title = "Team Wins vs. Average Assist to Turnover Ratio",
       x = "Total Wins",
       y = "Team Assist to Turnover Ratio") +
  geom_text_repel(data = p5, aes(x = total_wins, y = avg_team_ator, label = home_team_name))


```

Creating the model 
```{r}

model1 <- lm(total_wins ~ avg_team_ator, data = joined_home_team_ator)
summary(model1)

```

Exploration and explaination
- From what I did so far, the weakness I could see myself running into is mixing up the hmme team and away team and the context for which I am analyzing games. 

- Using the model, we learn that there is some sort of relationship because there is a lower p-value, the adjusted R squared number is around 0.3 which shows there is some relationship but it may not be as strongly correlated to the number of wins a team has. The residual standard of error is is 3.6 which means this is a good comparison.  

Some further things I'm curious about are if having a certain astor could predict the number of wins a team could get. Essentially saying "having an astor over 0.7 for X games should result in X wins" 

This may be a bit too complex to analyze. But could also be an obvious question that I may want to answer but dont know hwo to at this moment.


Another question
- Could I make a list of players' assist to turn over ratio and then make a beesworm plot (yes I looked ahead in the book) to find how point guards from a certain confernece ranked in the category? Maybe say Eliza Pinzan had a better Assist to turnover ratio in home games vs Aaway games. 


