---
title: "Final Project: Do teams with internatinal players perform better than those who don't"
author: "Dylan Manfre"
date: '2023-11-07'
format: 
  html:
    code-fold: true
---

```{r}
library(tidyverse)
library(janitor)
library(lubridate)
#install.packages("remotes")
#remotes::install_github("slu-openGIS/postmastr")
library(postmastr)
library(usdata)
library(rvest)
```

```{r}
# Loading data for the seaosns
logs18_24 <- read_csv("https://www.thescoop.org/sports-data-files/wbblogs1824.csv")

# Loading player data from 2022-2023
wbb23_24_rosters <- read_csv("data/wbb_rosters_2023_24.csv")
wbb22_23_rosters <- read_csv("data/wbb_rosters_2022_23.csv")

```


-------- Exploratory data section for 2023-2024 ----------

What do I want to accomplish: I want to see what teams have the most international players and how those teams have performed over recent years to answer the core question: Do teams with international players that contribute do better than ones who do not. 

Steps I need to take:
- Filter for every non-usa player. 
- Do a group_by() and summarize() to see which team has the most international players in the 2022-23 season. 
- See if any of them have transfered prior to the 2022-23 season and see where.
- Do an analysis of the teams with non-usa players in logs18_24 generating their season stats.

What I still need to do:
- Need to get player stats so I can see player stats who have actually contributed to their teams. 
- How do I get the individual player stats for the players who are internationals?
- Do I just do a team analysis based on the teams that have internationals?


filter for non-us players and counting by team
```{r}
# filtering for non-us players
non_us_players <- wbb23_24_rosters %>% 
  filter(country_clean != "USA", division == "I")

# counting teams with international players
teams_with_int_players <- non_us_players %>% 
  group_by(team, conference) %>% 
  summarize(int_players = n()) %>% 
  arrange(desc(int_players))

# where do international players come from
## Spain, Austrailia and Canada are the top three which makes sense. Spanish national team is very good.
countries <- non_us_players %>% 
    group_by(country_clean) %>% 
  summarize(int_players = n()) %>% 
  arrange(desc(int_players))
```


Here I will create a bolian mid-major column to see how many teams here are mid-majors vs. p5 and then count them.
```{r}
power_5 <- c("ACC", "Big 12", "Big Ten", "Pac-12", "SEC")

teams_with_int_players <- teams_with_int_players %>%
  mutate(mid_major_p5 = ifelse(conference %in% power_5, "power_5", "mid_major"))

# 316 more mid-majors than power_5 schools have international players. 
teams_with_int_players %>% 
  group_by(mid_major_p5) %>% 
  summarize(count = n())

```

# Possible question: What percentage of the conference total are on each team. I want to wrtie a sentence that hypothetically says: "Team X has 30% of the Big Ten's international players."

# From there, I can dive into how those players impact said teams.

```{r}
# Big Ten has 22 players
by_conf <- teams_with_int_players %>% 
  group_by(conference) %>% 
  summarise(int_players = sum(int_players)) %>% 
  mutate(conf_int_perc = int_players/sum(int_players)*100) %>% 
  arrange(desc(int_players))

# South Florida has 40% of the AAC's international players and the most in D1 with 12.

teams_with_int_players %>%
  summarise(total_int_players = sum(int_players)) %>% 
  mutate(team_perc_of_conf = total_int_players/sum(total_int_players)*100) %>% 
  arrange(desc(total_int_players))
```


STORY SENTENCE: `28% of Division I teams have at least one international player on its roster in 2023-24 season.`

# The overwhelming majority have one player. This is obvious and not really newsworthy.
```{r}
# How many teams have each number of players? Example sentence: 4 teams have 9 players.

number_of_teams_perc <- teams_with_int_players %>% 
  group_by(int_players) %>% 
  summarise(num_teams = n()) %>%
  mutate(number_of_teams_perc = num_teams/sum(num_teams)*100) %>% 
  arrange(desc(num_teams))
```

STORY SENTENCE: `18.3% of teams have at least 5 international players on their roster this season.`
```{r}
at_least_5 <- number_of_teams_perc %>% 
  filter(int_players >=5) %>% 
  summarise(at_least_5 = 52/sum(num_teams)*100)
```




I want to create a list of teams and their total players. Then I want to join that to `teams_with_international_players`. Then I want to create a percentage of international players on each team. I want to do this because in a story or analysis, percentages are easier to comprehend.

```{r}
# total_players df
total_players <-  wbb23_24_rosters %>% 
  group_by(team, conference) %>% 
  summarize(total_players = n()) %>% 
  arrange((team))

#joining

all_players <- inner_join(teams_with_int_players, total_players, by="team")

all_players <- all_players %>% select(-conference.y) %>% rename(conference = conference.x)

# perc_int

all_players <- all_players %>% 
  mutate(int_perc = (int_players/total_players)*100) %>% 
  arrange(desc(int_perc))

# What was the average amount of international players on a roster in 2022-23?```

# I want to get an average amount of players, then filter out any teams that are below that average. The ones with more players are more likely the ones who will contribute more to their program.

```


Do something like this to form categories of players: "Less than five" "more than five" 

```{r}

all_players_categories <- all_players %>%
  mutate(
    int_players_categories = case_when(
        int_players < 5 ~ "Less than 5",
        int_players >= 5 & int_players <= 10 ~ "Between 5 and 10 players",
        int_players > 10 ~ "Greater than 10 players",
      )
  )
head(all_players_categories)

all_players_categories %>% 
  group_by(int_players_categories) %>% 
  summarize(number_of_teams = n())
```

Question: How many teams have each number of players? 74 teams have 14 players, 72 teams have 15 players. There are 22 teams who have 12 players and the same number of teams have 16 players.
```{r}
all_players %>% 
  group_by(total_players) %>% 
  summarize(count = n())
```
Where do players on certain teams come from?
```{r}
non_us_players %>% 
  filter(team == "South Florida") %>% 
  group_by(country_clean) %>%
  summarise(count = n()) %>% 
  arrange(desc(count))
```

--------- Second Presentation Progress Update Nov. 18, 2023 -------
The central question I want to answer is do teams with higher amounts of international players preform better than those with fewer international players. What I've done so far is create dfs to answer the obvious questions of "Which teams, conferences, countries, have the most international players in Division I basketball?" I also generated percentages of non-us players on each team and I want to make that a focal point of my analysis too. The teams with majority international players are ones I'd like to focus on more in-depth. These could be the teams with five or more international players, which, according to the code I wrote, is 52 teams. I chose to break it up by 15 and 10 because most teams have between 12 to 15 total players on their roster.

My next task will be to create comparisons to the previous year's data 2022-2023 to see if the number of international players grew or not? If so, by how much. Essentially, I'm running all the above codes to answer those same questions but with last season's data. I'll need to be intentional and careful in my joins so that I know what is what. Then, my task will be to tackle how to measure the performances of the teams. Another question would be do I also do a player analysis? Say I get player stats from the `wehoops` database. How would I mark certain players as internationals. I have not yet looked at this so I don't know if it gives player bio information along with stats.

The issues I've run into are about thinking beyond the obvious questions. I know the ways I can expand this, but figuring out which would best serve my analysis and get me closer to the central answer of my question is where one issue lies. This is something we could talk through to see if I'm missing any of the obvious questions I need to answer that could point me in the right direction of what type of expansion would best serve me.



----------- Making comparisons to 2022-23 season ------------
```{r}
# Non_us_22_23 
non_us_22_23 <- wbb22_23_rosters %>% 
  filter(country_clean != "USA", division == "I")

head(non_us_22_23)
```

```{r}
# total roster size 22-23
roster_size_22_23 <- wbb22_23_rosters %>% 
  group_by(team, conference) %>% 
  summarize(total_players = n()) %>% 
  arrange((team))

# non-us-players and then joining with roster size
int_players_22_23 <- non_us_22_23 %>% 
  group_by(team, conference) %>% 
  summarize(int_players = n()) %>% 
  arrange(desc(int_players))

# joining
all_players_22_23 <- inner_join(int_players_22_23, roster_size_22_23, by="team")
head(all_players_22_23)

all_players_22_23 <- all_players_22_23 %>% select(-conference.y) %>% rename(conference = conference.x)

# perc_int

all_players_22_23 <- all_players_22_23 %>% 
  mutate(int_perc = (int_players/total_players)*100) %>% 
  arrange(desc(int_players))

# categories 
team_categories_22_23 <- all_players_22_23 %>%
  mutate(
    int_players_categories = case_when(
        int_players < 5 ~ "Less than 5",
        int_players >= 5 & int_players <= 10 ~ "Between 5 and 10 players",
        int_players > 10 ~ "Greater than 10 players",))

# by_conf_22_23

by_conf_22_23 <- int_players_22_23 %>% 
  group_by(conference) %>% 
  summarise(int_players = sum(int_players)) %>% 
  mutate(conf_int_perc = int_players/sum(int_players)*100) %>% 
  arrange(desc(int_players))

```

```{r}
# 22-23 number of teams with int_players_perc
int_players_22_23 %>% 
  group_by(int_players) %>% 
  summarise(num_teams = n()) %>%
  mutate(number_of_teams_perc = num_teams/sum(num_teams)*100) %>% 
  arrange(desc(num_teams))
```

------ SECTION ON JOINS AND DIFFERENCES -------

My goal here will be to join certain dfs together. I will be joining the ones that are most important to my analysis. Then, I will rename columns to label them as a 2022-23 season or 23-24 season. Then I will calculate the difference or percent change if necessary.

If a team or conference, significantly increases the number of international players, that can be newsworthy and helpful in the analysis.

analysis: The Big Ten, Big 12 and Sun Belt each lost six players while the ASUN gained 10 international players form 22-23 to the 23-24 season.
```{r}
# by conference
total_by_conf <- inner_join(by_conf, by_conf_22_23, by = "conference")
total_by_conf <- total_by_conf %>% 
  rename(int_players_23_24 = int_players.x,
          int_players_22_23 = int_players.y,
           perc_2023_24 = conf_int_perc.x,
          perc_2022_23 = conf_int_perc.y) %>%
  mutate(int_diff = int_players_23_24 - int_players_22_23)
```


```{r}
# by team category
categories_23_24 <- all_players_categories %>% 
  group_by(int_players_categories) %>% 
  summarize(number_of_teams = n())

categories_22_23 <- team_categories_22_23 %>% 
  group_by(int_players_categories) %>% 
  summarize(number_of_teams = n())

total_categories <- total_by_conf <- inner_join(categories_23_24, categories_22_23, by = "int_players_categories")
total_categories <- total_categories %>%
  rename(teams_23_24 = number_of_teams.x,
         teams_22_23 = number_of_teams.y) %>% 
  mutate(diff = teams_23_24 - teams_22_23)

head(total_categories)
```









