---
title: "Final Project: Do teams with internatinal players perform better than those who don't"
author: "Dylan Manfre"
date: '2023-11-07'
format: 
  html:
    code-fold: true
---

```{r}
library(tidyverse)
library(janitor)
library(lubridate)
#install.packages("remotes")
#remotes::install_github("slu-openGIS/postmastr")
library(postmastr)
library(usdata)
library(rvest)
```

```{r}
# Loading data for the seaosns
logs18_24 <- read_csv("https://www.thescoop.org/sports-data-files/wbblogs1824.csv")

# Loading player data from 2022-2023
wbb23_24_rosters <- read_csv("data/wbb_rosters_2023_24.csv")
wbb22_23_rosters <- read_csv("data/wbb_rosters_2022_23.csv")

```

-------- Exploratory data section ----------

What do I want to accomplish: I want to see what teams have the most international players and how those teams have performed over recent years to answer the core question: Do teams with international players that contribute do better than ones who do not. 

Steps I need to take:
- Filter for every non-usa player. 
- Do a group_by() and summarize() to see which team has the most international players in the 2022-23 season. 
- See if any of them have transfered prior to the 2022-23 season and see where.
- Do an analysis of the teams with non-usa players in logs18_24 generating their season stats.

What I still need to do:
- Need to get player stats so I can see player stats who have actually contributed to their teams. 
- How do I get the individual player stats for the players who are internationals?
- Do I just do a team analysis based on the teams that have internationals?


filter for non-us players and counting by team
```{r}
# filtering for non-us players
non_us_players <- wbb23_24_rosters %>% 
  filter(country_clean != "USA", division == "I")

# counting teams with international players
teams_with_int_players <- non_us_players %>% 
  group_by(team, conference) %>% 
  summarize(int_players = n()) %>% 
  arrange(desc(int_players))

# where do international players come from
## Spain, Austrailia and Canada are the top three which makes sense. Spanish national team is very good.
countries <- non_us_players %>% 
    group_by(country_clean) %>% 
  summarize(int_players = n()) %>% 
  arrange(desc(int_players))


```


Here I will create a bolian mid-major column to see how many teams here are mid-majors vs. p5 and then count them.
```{r}
power_5 <- c("ACC", "Big 12", "Big Ten", "Pac-12", "SEC")

teams_with_int_players <- teams_with_int_players %>%
  mutate(mid_major_p5 = ifelse(conference %in% power_5, "power_5", "mid_major"))

# 316 more mid-majors than power_5 schools have international players. 
teams_with_int_players %>% 
  group_by(mid_major_p5) %>% 
  summarize(count = n())

```

# Possible question: What percentage of the conference total are on each team. I want to wrtie a sentence that hypothetically says: "Team X has 30% of the Big Ten's international players."

# From there, I can dive into how those players impact said teams.

```{r}
# Big Ten has 22 players
by_conf <- teams_with_int_players %>% 
  group_by(conference) %>% 
  summarise(int_players = sum(int_players)) %>% 
  mutate(conf_int_perc = int_players/sum(int_players)*100) %>% 
  arrange(desc(int_players))

# Iona has 21% of the MAAC's international players.
teams_with_int_players %>% 
  filter(conference == "MAAC") %>%
  summarise(total_int_players = sum(int_players)) %>% 
  mutate(team_perc_of_conf = total_int_players/sum(total_int_players)*100)

```




I want to create a list of teams and their total players. Then I want to join that to `teams_with_international_players`. Then I want to create a percentage of international players on each team. I want to do this because in a story or analysis, percentages are easier to comprehend.

```{r}
# total_players df
total_players <-  wbb23_24_rosters %>% 
  group_by(team, conference) %>% 
  summarize(total_players = n()) %>% 
  arrange((team))

#joining

all_players <- inner_join(teams_with_int_players, total_players, by="team")

all_players <- all_players %>% select(-conference.y) %>% rename(conference = conference.x)

# perc_int

all_players <- all_players %>% 
  mutate(int_perc = (int_players/total_players)*100) %>% 
  arrange(desc(int_perc))

# What was the average amount of international players on a roster in 2022-23?```

# I want to get an average amount of players, then filter out any teams that are below that average. The ones with more players are more likely the ones who will contribute more to their program.



  

```








